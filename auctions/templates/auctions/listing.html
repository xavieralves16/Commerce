{% extends "auctions/layout.html" %}

{% block body %}
{% if messages %}
    <div class="messages">
      {% for message in messages %}
        <div class="message {{ message.tags }}">
          {{ message }}
        </div>
      {% endfor %}
    </div>
{% endif %}
<h2>{{listing.title}}</h2>

{% if listing.image_url %}
  <img src="{{ listing.image_url }}" alt="{{ listing.title }}" width="300">
{% endif %}

<p>{{ listing.description }}</p>
<p><strong>Category:</strong> {{ listing.category }}</p>
<p><strong>Current Price:</strong> ${{ current_price }}</p>

{% if listing.is_active %}
  {% if user.is_authenticated %}

    <form method="post">
      {% csrf_token %}
      <button type="submit" name="watchlist">
        {% if in_watchlist %}
            Remove from Watchlist
        {% else %}
            Add to Watchlist
        {% endif %}
      </button>
    </form>

    <form method="post">
      {% csrf_token %}
      <input type="number" step="0.01" name="bid_amount" placeholder="Your bid">
      <button type="submit" name="bid">Place Bid</button>
    </form>
  {% endif %}

  {% if user == listing.owner %}
    <form method="post">
      {% csrf_token %}
      <button type="submit" name="close">Close Auction</button>
    </form>
  {% endif %}

{% else %}
  <h3>This auction is closed.</h3>
  {% if listing.winner == user %}
    <p>You won this auction!</p>
  {% endif %}
{% endif %}

<hr>

<h3>Comments</h3>
<ul>
  {% for comment in comments %}
    <li><strong>{{ comment.commenter.username }}</strong>: {{ comment.content }}</li>
  {% empty %}
    <li>No comments yet.</li>
  {% endfor %}
</ul>

{% if user.is_authenticated %}
  <form method="post">
    {% csrf_token %}
    <textarea name="comment_content" placeholder="Add a comment"></textarea>
    <button type="submit" name="comment">Post</button>
  </form>
{% endif %}

{% endblock %}



