{% extends "auctions/layout.html" %}

{% block body %}
<div class="container mt-4">

  {% if messages %}
    <div class="mb-3">
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}

  <h2 class="mb-3">Listing: {{ listing.title }}</h2>
  <hr>

  {% if listing.image_url %}
    <div class="text-center mb-4">
      <img src="{{ listing.image_url }}" 
           alt="{{ listing.title }}" 
           class="img-fluid bg-light border rounded" 
           style="max-height: 300px; object-fit: contain; padding: 10px;">
    </div>
  {% endif %}

  <div class="mb-3">
    <p class="lead">{{ listing.description }}</p>
    <p><strong>Category:</strong> {{ listing.category }}</p>
    <h4 class="text-success">Current Price: ${{ current_price }}</h4>
  </div>

  {% if listing.is_active %}
    {% if user.is_authenticated %}
      <div class="d-flex flex-wrap gap-2 mb-3">
        <form method="post">
          {% csrf_token %}
          <button type="submit" name="watchlist" class="btn btn-outline-secondary">
            {% if in_watchlist %}
              Remove from Watchlist
            {% else %}
              Add to Watchlist
            {% endif %}
          </button>
        </form>

        <form method="post" class="d-flex gap-2">
          {% csrf_token %}
          <input type="number" step="0.01" name="bid_amount" 
                 placeholder="Your bid" 
                 class="form-control" style="width: 150px;">
          <button type="submit" name="bid" class="btn btn-primary">Place Bid</button>
        </form>
      </div>

      {% if user == listing.owner %}
        <form method="post" class="mt-2">
          {% csrf_token %}
          <button type="submit" name="close" class="btn btn-danger">Close Auction</button>
        </form>
      {% endif %}
    {% endif %}
  {% else %}
    <div class="alert alert-warning mt-3">
      <h5>This auction is closed.</h5>
      {% if listing.winner == user %}
        <p class="mb-0 text-success fw-bold">You won this auction!</p>
      {% endif %}
    </div>
  {% endif %}

  <hr>
  <h4 class="mb-3">Comments</h4>

  <ul class="list-group mb-3">
    {% for comment in comments %}
      <li class="list-group-item">
        <strong>{{ comment.commenter.username }}</strong>: {{ comment.content }}
      </li>
    {% empty %}
      <li class="list-group-item text-muted">No comments yet.</li>
    {% endfor %}
  </ul>

  {% if user.is_authenticated %}
    <form method="post" class="mb-4">
      {% csrf_token %}
      <textarea name="comment_content" class="form-control mb-2" 
                placeholder="Add a comment"></textarea>
      <button type="submit" name="comment" class="btn btn-success">Post</button>
    </form>
  {% endif %}
</div>
{% endblock %}



